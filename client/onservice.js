/**
 * OnService v0.0.1 @ 2018/07/22
 * License: MIT
 * Author: Wallace Rio (http://wallrio.com)
 */

var OnService=new function t(e){this.version="0.0.1",this.config={domain:""},this.attachModule=function(e){var n=e;t.prototype[(new n).name]=n}},OnServiceEssentials=function(){function OnServiceEssentials(){var self=this;return self.name="essentials",self.stringToObject=function(sJson){return null==sJson&&(sJson=""),eval("var obj={"+sJson+"}"),obj},self.ajax=function(e){var n=e.url||null,t=e.success||null,r=e.error||null,s=e.progress||null,c=e.data||null,a=e.method||"get";if(!1===e.async)var o=!1;else o=!0;var i,l=function(){try{return new XMLHttpRequest}catch(e){}try{return new ActiveXObject("Msxml3.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}return null}();"get"==a.toLowerCase()&&null!=c&&(n=n+"?"+(i=c,""+Object.keys(i).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(i[e])}).join("&"))),l.open(a,n,o),l.upload&&(l.upload.onprogress=function(e){e.lengthComputable&&s&&s(e.loaded,e.total)},l.upload.onloadstart=function(e){s&&s(0,e.total)},l.upload.onloadend=function(e){s&&s(e.loaded,e.total)},l.upload.onprogress=function(e){if(e.lengthComputable)Math.floor(e.loaded/e.total*100)}),l.onreadystatechange=function(){if(3<l.readyState){if(404===l.status||0==l.status)return r&&r(l.responseText),!1;t&&t(l.responseText)}};var u=new FormData;for(var d in c)c.hasOwnProperty(d)&&u.append(d,c[d]);"get"==a.toLowerCase()?l.send():l.send(u)},self.JSON={parse:function(e){try{return JSON.parse(e)}catch(e){return{}}},check:function(e){try{JSON.parse(e)}catch(e){return!1}return!0}},self.addEvent=function(e,n,a,t,r,s,c){var o=n.split(" "),i=arguments,l=function(e,n,t){null==n&&(n=!0);var r=e;null==r&&(r=window),nArgs_reindex=[];nArgs_reindex[0]=!1;for(var s=0;s<t.length;s++)3<s&&(nArgs_reindex[nArgs_reindex.length]=t[s]);if(r.addEventListener)for(s=0;s<o.length;s++){var c=o[s];!function(n,t,r,e,s){t.addEventListener(s,function(e){if(n[0]=e,r)return r.apply(t,n)},e)}(nArgs_reindex,r,a,n,c)}else if(r.attachEvent)for(s=0;s<o.length;s++){c=o[s];r.attachEvent("on"+c,function(e){if(nArgs_reindex[0]=e,a)return a.call(r,nArgs_reindex)})}};if("string"!=typeof e)l(e,t,i);else for(var u=document.querySelectorAll(e),d=0;d<u.length;d++){var f=u[d];l(f,t,i)}},this}return new OnServiceEssentials};OnService.attachModule(OnServiceEssentials);var OnServiceLongPolling=function(){return new function(){var p=this;return p.name="longpolling",p.config=function(e,n){null==n&&(n="start");var t=Math.floor(Date.now()/1e3),r=e.url,s=e.id||t,c=e.connect||null,a=e.disconnect||null,o=e.keep||null,i=e.stop||null,l=e.sended||null,u=e.received||null,d=e.error||null,f=e.options||null;if(p.id=s,p.url=r,p.connectcallback=c,p.disconnectcallback=a,p.keepcallback=o,p.stop=i,p.sendcallback=l,p.receivedcallback=u,p.error=d,p.options=f,!(p.status=null)===e.tryagain)var v=!0;else v=!1;p.tryagain=v},p.disconnect=function(){(new OnService.essentials).ajax({url:p.url,method:"get",data:{signal:"disconnect",id:p.id},error:function(e){p.error("no-connection")},success:function(e){var n=(new OnService.essentials).JSON.parse(e);"success"==n.status?(p.status="disconnect",p.disconnectcallback(n)):p.error(e)}})},p.connect=function(){p.status=null,(new OnService.essentials).ajax({url:p.url,method:"get",data:{signal:"connect",id:p.id,options:JSON.stringify(p.options)},error:function(e){p.error("no-connection")},success:function(e){var n=(new OnService.essentials).JSON.parse(e);"success"==n.status?(setTimeout(function(){p.keep()}),p.connectcallback(n)):p.error(e)}})},p.receivedConfirm=function(e){(new OnService.essentials).ajax({url:p.url,method:"get",data:{signal:"receivedconfirm",id:p.id,data:JSON.stringify(e)},error:function(e){p.error("no-connection")},success:function(e){var n=(new OnService.essentials).JSON.parse(e);"success"==n.status?p.keep(n):p.error(e)}})},p.keep=function(){(new OnService.essentials).ajax({url:p.url,method:"get",data:{signal:"keep",id:p.id},error:function(e){p.error("no-connection")},success:function(e){if("disconnect"==p.status)return!1;var n=(new OnService.essentials).JSON.parse(e);"success"==n.status?(p.keep(n),p.keepcallback(n)):"message"==n.status?(p.receivedConfirm(n.data),p.receivedcallback(n)):p.error(e)}})},p.send=function(e,n){(new OnService.essentials).ajax({url:p.url,method:"get",data:{signal:"message",to:e,id:p.id,data:JSON.stringify(n)},success:function(e){var n=(new OnService.essentials).JSON.parse(e);"success"==n.status?p.sendcallback(n):p.error(e)}})},this}};OnService.attachModule(OnServiceLongPolling);